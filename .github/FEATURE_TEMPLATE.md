# 新機能設計書: [機能名]

> このテンプレートを使用して新機能を設計します。
> コピーして `Docs/Features/` に保存し、内容を記入してください。

---

## 📋 基本情報

| 項目 | 内容 |
|------|------|
| **機能名（日本語）** | 例: 壁高さ一括変更 |
| **機能名（英語）** | 例: WallHeight |
| **クラス名** | 例: WallHeightCommand |
| **優先度** | 高 / 中 / 低 |
| **実装予定日** | YYYY-MM-DD |

### 概要
<!-- この機能が何をするものか、簡潔に説明（2-3文） -->

### 目的・背景
<!-- なぜこの機能が必要なのか、どんな問題を解決するのか -->

---

## 🎨 UI設計

### リボン配置

| 項目 | 内容 |
|------|------|
| **リボンタブ** | 28 Tools（固定） |
| **リボンパネル** | 例: 編集 / 表示 / ビュー / シート |
| **ボタン名** | 例: 壁高さ変更 |
| **ツールチップ** | 例: 選択した壁の高さを一括変更 |

### アイコン

- [ ] アイコンが必要
  - ファイル名: `Resources/Icons/[FeatureName].png`
  - サイズ: 32x32 PNG
  - デザイン案: <!-- アイコンのイメージを記述 -->

- [ ] アイコン不要（テキストボタンのみ）

### ダイアログ（UI）

- [ ] ダイアログ（WPF）が必要
  - タイトル: <!-- ダイアログのタイトル -->
  - 入力項目:
    - <!-- 入力フィールド1 -->
    - <!-- 入力フィールド2 -->
  - ボタン:
    - [ ] OK / キャンセル
    - [ ] 適用 / 閉じる
    - [ ] その他: ___________

- [ ] ダイアログ不要（即座に実行）

---

## 🔧 技術仕様

### 対象ビュー・要素

| 項目 | 内容 |
|------|------|
| **対象ビュータイプ** | 全ビュー / 平面図 / 3Dビュー / 断面図 / シートビュー / その他:______ |
| **対象要素** | 例: 壁（Wall）、床（Floor）、通り芯（Grid） |
| **選択方法** | 事前選択 / ダイアログで選択 / フィルタで自動選択 |

### トランザクション

- [ ] `TransactionMode.Manual`（推奨 - 手動制御）
- [ ] `TransactionMode.ReadOnly`（読み取り専用）
- [ ] `TransactionMode.Automatic`（自動）

### 使用するRevit API

<!-- この機能で使用する主なRevit APIクラス・メソッドをリストアップ -->
- `Document`
- `Transaction`
- 例: `FilteredElementCollector`
- 例: `Element.get_Parameter()`
- 例: `Parameter.Set()`

### 条件付きコンパイル

- [ ] バージョン固有の処理が必要
  - Revit 20XX 以降: <!-- 処理内容 -->
  - Revit 20XX 以前: <!-- 処理内容 -->

- [ ] 全バージョン共通

---

## 📝 機能詳細

### 処理フロー

```
1. ユーザーがボタンをクリック
   ↓
2. [処理ステップ2を記述]
   ↓
3. [処理ステップ3を記述]
   ↓
4. 結果を表示 / 完了メッセージ
```

### 入力

| 入力項目 | 型 | 必須 | 説明 |
|---------|-----|------|------|
| 例: 新しい高さ | double | ○ | 変更後の壁高さ（mm） |
| 例: 対象レベル | Level | × | フィルタ用レベル |

### 出力

| 出力項目 | 型 | 説明 |
|---------|-----|------|
| 例: 変更件数 | int | 変更された壁の数 |
| 例: エラー件数 | int | 処理に失敗した壁の数 |

### エラーハンドリング

<!-- どのようなエラーが発生しうるか、どう対処するか -->
- 対象要素が見つからない場合: <!-- 対処方法 -->
- パラメータが編集不可の場合: <!-- 対処方法 -->
- トランザクション失敗時: <!-- 対処方法 -->

---

## 🛠️ 実装計画

### ファイル構成

```
Commands/[FeatureName]/
├── [FeatureName]Command.cs       # コマンド本体
├── [FeatureName]Dialog.xaml      # WPFダイアログ（必要な場合）
├── [FeatureName]Dialog.xaml.cs   # ダイアログコードビハインド
└── [FeatureName]Helpers.cs       # ヘルパークラス（必要な場合）
```

### 実装ステップ

- [ ] 1. コマンドクラスの基本構造を作成
- [ ] 2. UIダイアログを作成（必要な場合）
- [ ] 3. コア処理ロジックを実装
- [ ] 4. Application.csにリボンボタンを登録
- [ ] 5. アイコンを作成・追加（必要な場合）
- [ ] 6. エラーハンドリングを追加
- [ ] 7. デバッグログを追加

### 依存関係

<!-- この機能が依存する他の機能やライブラリ -->
- なし
- 例: ViewCopyCommandの処理を参考にする
- 例: 外部ライブラリ: ___________

---

## 🧪 テスト計画

### テストケース

| No. | テスト内容 | 期待される動作 | 結果 |
|-----|-----------|---------------|------|
| 1 | 例: 壁を1つ選択して実行 | 高さが変更される | ☐ |
| 2 | 例: 壁を複数選択して実行 | 全ての壁の高さが変更される | ☐ |
| 3 | 例: 何も選択せずに実行 | エラーメッセージが表示される | ☐ |
| 4 | 例: 編集不可の壁を選択 | スキップして他の壁を処理 | ☐ |

### テスト環境

- [ ] Revit 2022（開発環境）
- [ ] Revit 2024（追加検証）
- [ ] Revit 2026（最新版検証）

### 想定される問題点

<!-- 実装時に発生しそうな問題や注意点 -->
1. 例: カーテンウォールは高さパラメータの扱いが特殊
2. 例: リンクファイル内の壁は編集できない

---

## 📚 参考資料

### 既存コード

<!-- 参考にする既存のコマンド -->
- 例: `Commands/GridBubble/` - パラメータ変更の基本
- 例: `Commands/SheetCreation/` - WPFダイアログの実装例

### 外部ドキュメント

<!-- Revit API ドキュメントや参考URL -->
- Revit API Docs: https://www.revitapidocs.com/
- 例: Wall クラス: https://www.revitapidocs.com/2022/...

---

## ✅ チェックリスト

### 設計フェーズ

- [ ] 基本情報を記入
- [ ] UI設計を決定
- [ ] 技術仕様を確認
- [ ] 処理フローを明確化
- [ ] テストケースを作成

### 実装フェーズ

- [ ] コマンドクラスを実装
- [ ] リボンに登録
- [ ] アイコンを作成（必要な場合）
- [ ] WPFダイアログを作成（必要な場合）
- [ ] QuickBuild.ps1でビルド成功
- [ ] Revit 2022で動作確認

### リリースフェーズ

- [ ] 全バージョンでビルド成功
- [ ] 複数バージョンで動作確認
- [ ] ドキュメント更新
- [ ] 配布パッケージ作成

---

## 📝 備考・メモ

<!-- その他の情報や開発中のメモ -->
