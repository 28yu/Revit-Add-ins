# CI/CD ガイド - 自動ビルド＆パッケージ作成

## 概要

このプロジェクトはGitHub Actionsを使用して、コードをプッシュするだけで自動的に全Revitバージョンのビルドとパッケージ作成を行います。

## 自動化フロー

```
コード編集 → git push → GitHub Actions → 自動ビルド → パッケージ作成 → ダウンロード可能
```

## 使い方

### 1. 通常の開発フロー

```bash
# コードを編集
# ...

# コミット＆プッシュ
git add .
git commit -m "機能追加: XXX"
git push
```

プッシュすると自動的に：
- Revit 2022, 2023, 2024, 2025 用のDLLがビルドされます
- ビルド結果はArtifactsとしてダウンロード可能です

### 2. ビルド結果のダウンロード

1. GitHubリポジトリの **Actions** タブを開く
2. 最新のワークフロー実行をクリック
3. **Artifacts** セクションから各バージョンのDLLをダウンロード

### 3. 配布パッケージの作成（mainブランチのみ）

`main` ブランチにプッシュすると、自動的に配布パッケージ（ZIP）が作成されます。

### 4. リリースの作成

コミットメッセージに `release:` を含めると、自動的にGitHub Releaseが作成されます：

```bash
git commit -m "release: v1.0.0 - 新機能追加"
git push origin main
```

## ワークフロー詳細

### トリガー

| イベント | 動作 |
|---------|------|
| `main` ブランチへのpush | ビルド + パッケージ作成 |
| `develop` ブランチへのpush | ビルドのみ |
| Pull Request | ビルドのみ |
| 手動実行 | ビルド + パッケージ作成 |

### 生成されるArtifacts

| 名前 | 内容 | 保持期間 |
|------|------|---------|
| Tools28-Revit2022 | Revit 2022用DLL | 30日 |
| Tools28-Revit2023 | Revit 2023用DLL | 30日 |
| Tools28-Revit2024 | Revit 2024用DLL | 30日 |
| Tools28-Revit2025 | Revit 2025用DLL | 30日 |
| Tools28-AllPackages | 全バージョンのZIPパッケージ | 90日 |

## 手動実行

GitHub Actionsを手動で実行することもできます：

1. **Actions** タブを開く
2. **Build and Package** ワークフローを選択
3. **Run workflow** ボタンをクリック
4. ブランチを選択して **Run workflow**

## ローカル開発との違い

| 項目 | ローカル | CI/CD |
|------|---------|-------|
| Revit API | ローカルインストール | NuGetパッケージ |
| ビルド環境 | Windows + Visual Studio | GitHub Actions (Windows) |
| 対応バージョン | インストール済みのみ | 2022-2025 |

## トラブルシューティング

### Q: ビルドが失敗する

1. **Actions** タブでエラーログを確認
2. 一般的な原因：
   - 構文エラー
   - 参照の問題
   - NuGetパッケージの取得失敗

### Q: パッケージが作成されない

- `main` ブランチにプッシュしているか確認
- ビルドジョブが成功しているか確認

### Q: Revit 2026がビルドされない

現時点でRevit 2026のNuGetパッケージが利用できない可能性があります。
利用可能になり次第、ワークフローに追加されます。

## ブラウザでの開発

### GitHub Codespaces

1. リポジトリページで **Code** ボタンをクリック
2. **Codespaces** タブを選択
3. **Create codespace on main** をクリック

数分でブラウザ内にVSCode環境が起動します。

### できること
- コードの編集
- Git操作（commit, push, pull）
- C#のIntelliSense（構文補完）
- ドキュメントの編集

### 制限事項
- 完全なビルドは不可（.NET Framework 4.8が必要）
- Revitでのテストは不可

→ **ビルドはGitHub Actionsに任せる** という運用がおすすめです。

## 推奨ワークフロー

```
┌─────────────────┐     ┌──────────────────┐     ┌─────────────────┐
│   Codespaces    │────▶│   GitHub Actions │────▶│    Download     │
│   (コード編集)   │     │   (自動ビルド)    │     │   (パッケージ)   │
└─────────────────┘     └──────────────────┘     └─────────────────┘
        │                                                 │
        └─────────────────────────────────────────────────┘
                      ブラウザだけで完結！
```
